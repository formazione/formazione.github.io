<script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
<script src="quiz-e5e5aconfig.js"></script>
<style>
  html, body, {
    position:fixed;
    top:0;
    bottom:0;
    left:0;
    right:0;
    margin:0 auto;
    spacing:0;
}

body {
  background-color:black;
    overflow-y:hidden;
}

#gc3 {
  position: relative;
  width:50vw;
  height:100vh;
  }
.mobileShow {display: none;} 

  /* Smartphone Portrait and Landscape */ 
  @media only screen 
    and (min-device-width : 320px) 
    and (max-device-width : 480px){ 
      .mobileShow {display: inline;}
  }
</style>
<body>
  
  <audio id="soundtrack">
  <source src="https://opengameart.org/sites/default/files/audio_preview/level3.mp3.ogg">
  </audio>
      <audio id="myAudio">
  <source src="https://opengameart.org/sites/default/files/audio_preview/pacman%20wakka.wav.ogg" type="audio/ogg">
  <source src="horse.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>
<script>
var x = document.getElementById("myAudio");
  x.volume = 1;
var soundtrack = document.getElementById("soundtrack");
  soundtrack.volume = 0.4;
  
function playSoundtrack(){
   soundtrack.play(); 
  }
  
function playAudio() { 
  x.play(); 
} 

function pauseAudio() { 
  x.pause(); 
} 
</script>
  <center>
  
    <canvas id="gc3" width="400" height="400"></canvas>
  
      <!-- pulsanti -->
    <center>
    <div class="mobileShow">
        <table> <!-- alto -->
        <td colspan="2" align="center">
        <canvas id="up" width="300" height="200" style="background:lime" onclick="moveup()" ontouchstart="moveup()"  ontouchmove="moveup()"></canvas></td>
          
          <tr><td>
         <canvas id="left" width="250" height="200" style="background:yellow" onclick="moveleft()" ontouchstart="moveleft()  ontouchmove="moveleft()""></canvas>
          </td><td>
          <canvas id="right" width="250" height="200" style="background:red" onclick="moveright()" ontouchstart="moveright()"  ontouchmove="moveright()">
          </canvas><tr>
            
            <!-- basso -->
            <td colspan="2" align="center">
        <canvas id="down" width="300" height="200" style="background:blue" onclick="movedown()" ontouchstart="movedown()"  ontouchmove="movedown()"></canvas></center>
          </canvas></td>
    </table>
    </center>
  </center>
  
</div>
  
  <script>
window.onload=function () {
    var vel = 8;
    canv3 = document.getElementById("gc3");
    ctx3 = canv3.getContext("2d");
    document.addEventListener("keydown",keyPush);
    setInterval(game,1000/vel);
}
playSoundtrack();
let px = 10; // posizione iniziale player
let py = 10;
let gs = 30; // dimensione di una cella? o numero di celle?
let tc = 20;

let ax = 25; // coordinate iniziali frutto 1
let ay = 15;

let ax2 = 5; // coordinate iniziali frutto 2
let ay2 = 5;

let ax3 = 1; // coordinate iniziali ostacolo
let ay3 = 1;
let ax4 = 2; // coordinate iniziali ostacolo n.2
let ay4 = 2;

let xv = 0;
let yv = 0;

let trail=[]; // array con le parti di snake
let tail = 5; // dimensioni iniziali della coda
let sc = 0; // punteggio
let rec= 0;
ref1.child("snake").child("record").on("value", snap => rec = snap.val());   // 95 and 227 are with these stuffs
var vel = 5;

// Imamgini dei due frutti e dell'ostacolo (che ora Ã¨ un rettangolo)
let img = new Image()
let img2 = new Image()
//let img3 = new Image()

// Le immagini dei frutti
imgs = [
      // pear
        "https://cdn.glitch.com/9778987b-2a7d-4797-bd0a-a7219e55295a%2Fpear.png?1546407679651",
  // apple      
  "https://cdn.glitch.com/9778987b-2a7d-4797-bd0a-a7219e55295a%2Fapple256.png?1546333034026",
       // bug yellow
        "https://cdn0.iconfinder.com/data/icons/bugs-insects-yellow/61/39_-Moth-_bug_insect_nature-128.png",
  //bee yellow
  "https://cdn2.iconfinder.com/data/icons/spring-30/30/Honey_Bee-128.png",

  //butterfly
  "https://www.monarchtitle.com/wp-content/uploads/2016/10/cropped-site-icon.png",
  // my ant
  "https://cdn.glitch.com/9778987b-2a7d-4797-bd0a-a7219e55295a%2Fant.png?1546792017562",
  "https://cdn.glitch.com/9778987b-2a7d-4797-bd0a-a7219e55295a%2Fant2.png?1546792290141",
  "https://cdn.glitch.com/9778987b-2a7d-4797-bd0a-a7219e55295a%2Fscarabeo.png?1546792731755"
       ];
    
  
// le immagini dei nemici, per ora non sono usate
enemy = ["https://s24255.pcdn.co/wp-content/uploads/2014/02/unblock-blocked-websites.png",
        "https://www.cloisters.com/images/easyblog_images/116/220px-No_Smoking.svg.png"];


var fps = 15;
var maxAppleAgeSeconds = 5;
var appleAge = 0;
var maxAppleAgeFrames = fps * maxAppleAgeSeconds;
var rand = changecolor();
  
function changecolor(){
    colorlist = ["lime","orange","cyan","pink","yellow"];
    var rand = colorlist[Math.floor(Math.random() * colorlist.length)]; 
    return rand;
  }
  
function randomFruit(){
    var rndfrt = imgs[Math.floor(Math.random() * imgs.length)];
    return rndfrt;
  }
  
function randomEnemy(){
    var rndfrt = enemy[Math.floor(Math.random() * enemy.length)];
    return rndfrt;
  }
  
  // get a random fruit
  img.src = randomFruit();
  img2.src = randomFruit();
  //img3.src = randomEnemy();

    // text used for boom
function write(testo, x, y){
    ctx3.font = "32px Comic Sans MS";
    ctx3.fillStyle = "blue";
    ctx3.textAlign = "left";
    ctx3.fillText(testo , x, y); 
}
    // circle used for effect boom
function circle(x,y){
  ctx3.fillStyle = 'red';
  ctx3.globalAlpha = 0.1;
  ctx3.beginPath();
  ctx3.ellipse(x, y, 50, 50, Math.PI, 0, Math.PI * 3.5);
  ctx3.fill();
  ctx3.globalAlpha = 1;
}
                        //   effett when you hit an enemy (uses circle and write)
function boom(x,y){
  playAudio();
  circle(x*gs,y*gs);
  //ctx3.fillRect(x*gs-10,y*gs-10, 40, 40);
  //ctx3.fillRect(x*gs-20,y*gs-20, 60, 60);
  //ctx3.fillRect(x*gs-40,y*gs-40, 80, 80);
  write("50 pt", x*gs,y*gs);
}
    
function flash(num){
    rand = changecolor();
    ctx3.fillStyle = rand;
    if (num==1){
      boom(ax,ay);
      img.src = randomFruit();
      movefruit1();
    }
    if (num==2) {
      boom(ax2,ay2);
      ctx3.ellipse(ax2*gs,ay2*gs, 50, 50, Math.PI, -3.5, Math.PI);
      img2.src = randomFruit();
      movefruit2();
    }
    tail+=3;
    sc += 50;
    appleAge = 0;
    moveenemy()
  }
  
function screen(){
    // fills the screen of black
    ctx3.fillStyle="white";
    ctx3.fillRect(0,0,canv3.width,20);
    ctx3.fillStyle="darkblue";
    ctx3.fillRect(0,20,canv3.width+20,canv3.height+20);
    ctx3.fillStyle="lime";
    ctx3.fillRect(10,400,canv3.width,canv3.height+50);
  }

    
function score(){
    // draws the text score
    ctx3.font = "16px Comic Sans MS";
    ctx3.fillStyle = "blue";
    ctx3.textAlign = "left";
    ctx3.fillText("Highest:" + rec + " - Score: " + sc , 0,15); 
  }
  
function lose(){
              tail = 5;
              px=py=10;
              gs=tc=20;
              ax=ay=15;
              ax2=ay2=5;
              xv=yv=0;
              trail=[];
              if (sc > rec) {
                rec = sc;
              // how this works? ----------------------------------------- 227 vs 113
                ref1.child("snake").child("record").set(rec)
              // -----------------------------------------------------------
              }
                sc = 0;
  }
  
function movefruit1(){
      ax = Math.floor(Math.random() * tc);
      ay = Math.floor(Math.random() * tc);
  }
  
function movefruit2(){
      ax2 = Math.floor(Math.random() * tc);
      ay2 = Math.floor(Math.random() * tc); 
  }
  
function moveenemy(){
      ax3 = Math.floor(Math.random() * tc);
      ay3 = Math.floor(Math.random() * tc);
      ax4 = Math.floor(Math.random() * tc);
      ay4 = Math.floor(Math.random() * tc);
  }
  

function probmove1(){
  let rnd = Math.random()*100;
   if (rnd < 30){
    ax += Math.floor(Math.random()*1);
  }
  else if (rnd > 30 && rnd < 33 ){
    ax += Math.floor(Math.random()*-1);
  }
    else if (rnd > 33 && rnd <36 ){
    ay += Math.floor(Math.random()*+1);
  }
      else if (rnd > 36 && rnd <39){
    ay += Math.floor(Math.random()*-1);
  }
    if (ax > 19) ax = 19;
  if (ay > 19) ay = 19;
  if (ax < 1) ax = 1;
  if (ax < 1) ay = 1;
}
    
function probmove2(){
  let rnd = Math.random()*100;
       if (rnd < 30){
      ax2 += Math.floor(Math.random()*1);
    }
    else if (rnd > 30 && rnd < 33 ){
      ax2 += Math.floor(Math.random()*-1);
    }
      else if (rnd > 33 && rnd <36 ){
      ay2 += Math.floor(Math.random()*+1);
    }
        else if (rnd > 36 && rnd <39){
      ay2 += Math.floor(Math.random()*-1);
    }
    if (ax2 > 19) ax2 = 19;
  if (ay2 > 19) ay2 = 19;
  if (ax2 < 1) ax2 = 1;
  if (ay2 < 1) ay2 = 1;
}
    
function game() {
    screen() // PAINT THE SCREEN
    score() // DRAW THE SCORE
    px += xv; // at start is 0
    py += yv; // at start is 0
    // LOSE WHEN GOING OUT OF SCREEN
    if (px<-1 || px>tc || py<0 || py>tc) lose(); 
    //The snake has a random color
    ctx3.fillStyle= rand;
    // crea tanti quadrati quanta la lunghezza di trail
    for(var i=0;i<trail.length;i++) {
        ctx3.fillRect(trail[i].x*gs,trail[i].y*gs,gs-2,gs-2);
      // collision ?
        if(trail[i].x==px && trail[i].y==py) {
              lose()
        }
    }
    trail.push({x:px, y:py});
    while(trail.length>tail) {
    trail.shift();
    }

  appleAge++;
  
  // probability to move of fruit 1
  probmove1();
  probmove2();

  // catch the apple
  if (ax == px && ay == py) flash(1);
  if (ax2 == px && ay2 == py) flash(2);
  
  
  // Se il tempo della mela passa si sposta a caso
  else if (appleAge > maxAppleAgeFrames) {
      ax = Math.floor(Math.random() * tc);
      ay = Math.floor(Math.random() * tc);
      ax2 = Math.floor(Math.random() * tc);
      ay2 = Math.floor(Math.random() * tc);
      sc -= 10;
      tail+=3;
      appleAge = 0;
        } 
  // dopo mostra la mela e gli ostacoli
  ctx3.drawImage(img, ax*gs,ay*gs-3, 20, 20);
  ctx3.drawImage(img2, ax2*gs,ay2*gs-3, 20, 20);
}
    
    
var z = 0; // avoid doing left-right or top-down
function moveleft(){
  if (z!=3){
            xv=-1;
            yv=0;
            z=2;
  }
}
  function moveright(){
    if (z!=2){
            xv=1;
            yv=0;
            z=3;
    }
  }
function moveup(){
  if (z!=4){
            xv=0;
            yv=-1;
            z=1;
  }
}
  function movedown(){
    if (z!=1){
            xv=0;
            yv=1;
            z=4;
    }
}
    
function keyPush(evt) {
  if (evt.keyCode==37) moveleft();
  else if (evt.keyCode==38) moveup();
  else if (evt.keyCode==39) moveright();
  else if (evt.keyCode==40) movedown();
    } 
  

</script>
<!-- the glitch button that can make you remix this -->
<!--
<div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
<script src="https://button.glitch.me/button.js"></script>
-->
</body>